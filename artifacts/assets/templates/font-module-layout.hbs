{{!-- render the head contributions --}}
{{#eq $layoutMode "head"}}
    {{#each head ~}}
        {{#eq mode "preview"}}
            {{#if @root.$context.hub.isPreview}}
                {{#each embed ~}}
                    {{{trim .}}}
                {{/each ~}}

                {{! External references }}
                {{#each reference ~}}
                    {{{trim $markup}}}
                {{/each ~}}
            {{/if}}
        {{/eq}}
        {{#eq mode "live"}}
            {{#unless @root.$context.hub.isPreview}}
                {{#each embed ~}}
                    {{{trim .}}}
                {{/each ~}}

                {{! External references }}
                {{#each reference ~}}
                    {{{trim $markup}}}
                {{/each ~}}
            {{/unless}}
        {{/eq}}
        {{#eq mode "always"}}
            {{#each embed ~}}
                {{{trim .}}}
            {{/each ~}}

            {{! External references }}
            {{#each reference ~}}
                {{{trim $markup}}}
            {{/each ~}}
        {{/eq}}
    {{/each ~}}
{{/eq}}
{{!-- render the body contributions --}}
{{#eq $layoutMode "body"}}
    {{#each body ~}}
        {{#eq mode "preview"}}
            {{#if @root.$context.hub.isPreview}}
                {{#each embed ~}}
                    {{{trim .}}}
                {{/each ~}}

                {{! External references }}
                {{#each reference ~}}
                    {{{trim $markup}}}
                {{/each ~}}
            {{/if}}
        {{/eq}}
        {{#eq mode "live"}}
            {{#unless @root.$context.hub.isPreview}}
                {{#each embed ~}}
                    {{{trim .}}}
                {{/each ~}}

                {{! External references }}
                {{#each reference ~}}
                    {{{trim $markup}}}
                {{/each ~}}
            {{/unless}}
        {{/eq}}
        {{#eq mode "always"}}
            {{#each embed ~}}
                {{{trim .}}}
            {{/each ~}}

            {{! External references }}
            {{#each reference ~}}
                {{{trim $markup}}}
            {{/each ~}}
        {{/eq}}
    {{/each ~}}
{{/eq}}
{{!-- render the json contributions --}}
{{#unlessEq $layoutMode "head"}}
{{#unlessEq $layoutMode "body"}}
    { "fontFamily": {{{stringify fontFamily}}} }
{{/unlessEq}}
{{/unlessEq}}
